name: Check Status of APIs for openapi-examples

on:
  schedule:
    # Run every 6 hours
    - cron: '0 */6 * * *'
  # Run manually
  workflow_dispatch: {}

jobs:
  check-status-of-apis:
    runs-on: ubicloud
    defaults:
      run:
        working-directory: sdks/
    steps:
      - name: Checkout code
        uses: actions/checkout@v2
        with:
          submodules: 'sdks/openapi-examples'
          token: ${{ secrets.SUBMODULES_ACCESS_TOKEN }}
        continue-on-error: true

      - uses: actions/setup-node@v3
        with:
          node-version: ${{ matrix.node_version }}
          cache: yarn
          cache-dependency-path: sdks/yarn.lock
      - run: yarn install --network-timeout 600000
      - name: Pull Latest Changes in sdks/openapi-examples
        run: |
          cd sdks/openapi-examples
          git pull
      - run: yarn check-status-of-apis
      - name: Commit and push changes
        if: success()
        run: |
          git config --global user.email "publisher@konfigthis.com"
          git config --global user.name "konfig-publisher"
          git commit -am "ðŸ¤– automation: update status of APIs"
          git push

